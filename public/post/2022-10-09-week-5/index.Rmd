---
title: Week 5
author: Hannah Valencia
date: '2022-10-09'
slug: []
categories: []
tags: []
summary: "This week we learned about the effect of advertising on election outcomes at the district level. There is some conflicting literature about the effects of advertising on informing, mobilizing, and persuading voters. In this blog, I will look at trends between advertising data and vote shares in previous elections, then add to my model predicting the 2022 House election."
---

*This blog is part of a series related to Gov 1347: Election Analytics, a course at [Harvard University](https://www.harvard.edu/) taught by Professor [Ryan D. Enos](http://ryandenos.com/)*.

This week we learned about the effect of advertising on election outcomes at the district level. There is some conflicting literature about the effects of advertising on informing, mobilizing, and persuading voters. In this blog, I will look at trends between advertising data and vote shares in previous elections, then add to my model predicting the 2022 House election.

This week we learned about how advertising can affect the outcomes of elections, with campaigns running ads on social media, radio, and television, with different goals in mind. Advertisements can be used to promote a candidate, attack the opposition, or both. Ads can also highlight important political issues for each party, from health care and abortion to taxes and government spending. While advertising campaigns do have an impact on voter knowledge and interest, we are curious if they imapct the actual results of the election in the form of who voters choose to vote for. [Huber and Arceneaux (2007)](https://hollis.harvard.edu/primo-explore/fulldisplay?docid=TN_cdi_proquest_miscellaneous_59786011&context=PC&vid=HVD2&search_scope=everything&tab=everything&lang=en_US), find that contrary to previous research in this area, "Advertising does a little to inform, next to nothing to mobilize, and a great deal to persuade potential voters". In analyzing this data, we can hope to find some relationships that are useful to our prediction models and good predictors for house election outcomes in each district.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# load libraries

library(tidyverse)
library(usmap)
library(plotly)
library(rmapshaper)
library(sf)
library(haven)
library(sjlabelled)
library(usdata)
library(stargazer)
```


```{r}

# reading ad files for lab

ads1 <- read_csv("ads_2006_2018 (1).csv")
ad_issues1 <- read_csv("ads_issues_2012-2018 (1).csv")

# reading WMP files

# wmp_2012 <- read_dta("wmp-house-2012-v1.1.dta")
# wmp_2014 <- readRDS("WMP_house_gen_2014_ads_cleaned.rds")
# wmp_2016 <- readRDS("WMP_house_gen_2016_ads_cleaned.rds")
# wmp_2018 <- readRDS("WMP_house_gen_2018_ads_cleaned.rds")
```

```{r LabQ1, eval=FALSE}

# Lab Question 1: What are some trends in the tone and purpose of Democratic ads?

ads1 %>%
  filter(party == "Democrat") %>%
  group_by(ad_tone) %>%
  count() %>%
  arrange(desc(n))

ads1 %>%
  filter(party == "Democrat") %>%
  group_by(ad_purpose) %>%
  count() %>%
  arrange(desc(n))

ads1 %>%
  filter(party == "Democrat") %>%
  group_by(ad_tone, ad_purpose) %>%
  count() %>%
  arrange(desc(n))

```

```{r LabQ2, eval=FALSE}
ad_issues %>%
  filter(party == "Democrat") %>%
  group_by(issue) %>%
  count() %>%
  arrange(desc(n))
```

```{r CleanWMP, eval=FALSE}

# clean house 2012 data
house_2012 <- wmp_2012 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dmaid, airdate, airtime, categorystate,
         race, district, party, ad_tone, per_ply, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(state = categorystate, dma = dmaid) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# add st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2012$cd_fips <- ifelse(house_2012$district %in% nums, 
                             paste0("0",house_2012$district), 
                             house_2012$district)

house_2012$st_cd_fips <- paste(house_2012$st_fips,
                               house_2012$cd_fips,
                               sep = "")

# clean 2014
house_2014 <- wmp_2014 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, airdate, airtime, StateAbb,
         race, district, affiliation, ad_tone, per_ply, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = affiliation, state = StateAbb) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 
head(house_2014)

# add st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2014$cd_fips <- ifelse(house_2014$district %in% nums, 
                             paste0("0",house_2014$district), 
                             house_2014$district)

house_2014$st_cd_fips <- paste(house_2014$st_fips,
                               house_2014$cd_fips,
                               sep = "")

# label ad purpose variable
house_2014 <- house_2014 %>%
  mutate(per_ply = case_when(per_ply == 0 ~ "Neither",
                             per_ply == 1 ~ "Personal Characteristics",
                             per_ply == 2 ~ "Policy Matters",
                             per_ply == 3 ~ "Both Personal Characteristics and Policy Matters"),
         ad_tone = case_when(ad_tone == 1 ~ "Contrast",
                             ad_tone == 2 ~ "Promote", 
                             ad_tone == 3 ~ "Attack"))

# clean 2016
house_2016 <- wmp_2016 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, airdate, airtime, categorystate,
         race, district, Candidate_Party, ad_tone, per_ply, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = Candidate_Party, state = categorystate) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# add st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2016$cd_fips <- ifelse(house_2016$district %in% nums, 
                             paste0("0",house_2016$district), 
                             house_2016$district)

house_2016$st_cd_fips <- paste(house_2016$st_fips,
                               house_2016$cd_fips,
                               sep = "")

# clean 2018
house_2018 <- wmp_2018 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, airdate, airtime, categorystate,
         race, district, Candidate_Party, ad_tone, per_ply, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = Candidate_Party, state = categorystate) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2018$cd_fips <- ifelse(house_2018$district %in% nums, 
                             paste0("0",house_2018$district), 
                             house_2018$district)

house_2018$st_cd_fips <- paste(house_2018$st_fips,
                               house_2018$cd_fips,
                               sep = "")

# join now
names(house_2012)
names(house_2014)
names(house_2016)
names(house_2018)

h <- house_2012 %>%
  rbind(house_2014) %>%
  rbind(house_2016) %>%
  rbind(house_2018)

# write separate files - if necessary
 write.csv(house_2012, "house_2012.csv")
 write.csv(house_2014, "house_2014.csv")
 write.csv(house_2016, "house_2016.csv")
 write.csv(house_2018, "house_2018.csv")

```

```{r CleanHouseWMP, eval=FALSE}
table(h$party)
h <- h %>%
  mutate(party = case_when(party == 'Democrat' ~ 'Democrat',
                           party == 'DEMOCRAT' ~ 'Democrat',
                           party == 'Democratic' ~ 'Democrat',
                           party == 'REPUBLICAN' ~ 'Republican',
                           party == 'Republican' ~ 'Republican')) %>%
  mutate(ad_tone = tolower(ad_tone)) %>%
  filter(cycle %in% c(2006, 2010, 2012, 2014, 2016, 2018)) %>%
  rename(ad_purpose = per_ply) %>%
  mutate(ad_purpose = tolower(ad_purpose), 
         ad_purpose = case_when(ad_purpose == 'both personal char. and policy matters' ~ "both",
                                ad_purpose == 'both personal characteristics and policy matters' ~ "both",
                                ad_purpose == 'personal characteristics' ~ "personal",
                                ad_purpose == 'policy matters' ~ "policy")) %>%
  group_by(creative) %>%
  mutate(n_stations = length(unique(station))) %>% ungroup()

table(h$party)
table(h$ad_tone)
table(h$ad_purpose)
table(h$cycle)
head(h)
head(h$n_stations)
dim(h)
# export to csv
write.csv(h, "ads_2006_2018.csv")
```

```{r CleanHouseIssue, eval=FALSE}

# from R script
#### elections that include issues and cost 2012-2018 ####
# 2012
house_2012_is <- wmp_2012 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dmaid, issue, airdate, airtime, categorystate,
         race, district, party, ad_tone, per_ply, est_cost, station) %>%
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(state = categorystate, dma = dmaid) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2012_is$cd_fips <- ifelse(house_2012_is$district %in% nums, 
                                paste0("0",house_2012_is$district), 
                                house_2012_is$district)

house_2012_is$st_cd_fips <- paste(house_2012_is$st_fips,
                                  house_2012_is$cd_fips,
                                  sep = "")

# 2014
house_2014_is <- wmp_2014 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, issue, airdate, airtime, StateAbb,
         race, district, affiliation, ad_tone, per_ply, est_cost, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = affiliation, state = StateAbb) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2014_is$cd_fips <- ifelse(house_2014_is$district %in% nums, 
                                paste0("0",house_2014_is$district), 
                                house_2014_is$district)

house_2014_is$st_cd_fips <- paste(house_2014_is$st_fips,
                                  house_2014_is$cd_fips,
                                  sep = "")

house_2014_is <- house_2014_is %>%
  mutate(per_ply = case_when(per_ply == 0 ~ "Neither",
                             per_ply == 1 ~ "Personal Characteristics",
                             per_ply == 2 ~ "Policy Matters",
                             per_ply == 3 ~ "Both Personal Characteristics and Policy Matters"),
         ad_tone = case_when(ad_tone == 1 ~ "Contrast",
                             ad_tone == 2 ~ "Promote", 
                             ad_tone == 3 ~ "Attack"))

# 2016
house_2016_is <- wmp_2016 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, issue, airdate, airtime, categorystate,
         race, district, Candidate_Party, ad_tone, per_ply, est_cost, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = Candidate_Party, state = categorystate) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2016_is$cd_fips <- ifelse(house_2016_is$district %in% nums, 
                                paste0("0",house_2016_is$district), 
                                house_2016_is$district)

house_2016_is$st_cd_fips <- paste(house_2016_is$st_fips,
                                  house_2016_is$cd_fips,
                                  sep = "")

# 2018
house_2018_is <- wmp_2018 %>%
  filter(race == 'US HOUSE') %>%
  sjlabelled::as_label(party, ad_tone, per_ply) %>%
  select(creative, market, dma, issue, airdate, airtime, categorystate,
         race, district, Candidate_Party, ad_tone, per_ply, est_cost, station) %>% # issue not included bc diff dimensions
  mutate(cycle = substr(airdate,0,4)) %>%
  rename(party = Candidate_Party, state = categorystate) %>%
  mutate(state = abbr2state(state) ) %>%
  mutate(st_fips = case_when(state == 'Alabama' ~ '01',
                             state == 'Alaska' ~ '02',
                             state == 'Arizona' ~ '04',
                             state == 'Arkansas' ~ '05',
                             state =='California' ~ '06',
                             state =='Colorado' ~ '08',
                             state =='Connecticut' ~ '09',
                             state =='Delaware' ~ '10',
                             state == 'Florida' ~ '12',
                             state == 'Georgia' ~ '13',
                             state == 'Hawaii' ~ '15',
                             state =='Idaho' ~ '16',
                             state =='Illinois' ~ '17',
                             state =='Indiana' ~ '18',
                             state =='Iowa' ~ '19',
                             state =='Kansas' ~ '20',
                             state =='Kentucky' ~ '21',
                             state =='Louisiana' ~ '22',
                             state =='Maine' ~ '23',
                             state =='Maryland' ~ '24',
                             state =='Massachusetts' ~ '25',
                             state =='Michigan' ~ '26',
                             state =='Minnesota' ~ '27',
                             state =='Mississippi' ~ '28',
                             state =='Missouri' ~ '29',
                             state =='Montana' ~ '30',
                             state =='Nebraska' ~ '31',
                             state =='Nevada' ~ '32',
                             state =='New Hampshire' ~ '33',
                             state =='New Jersey' ~ '34',
                             state =='New Mexico' ~ '35',
                             state =='New York' ~ '36',
                             state =='North Carolina' ~ '37',
                             state =='North Dakota' ~ '38',
                             state =='Ohio' ~ '39',
                             state =='Oklahoma' ~ '40',
                             state =='Oregon' ~ '41',
                             state =='Pennsylvania' ~ '42',
                             state =='Rhode Island' ~ '44',
                             state =='South Carolina' ~ '45',
                             state =='South Dakota' ~ '46',
                             state =='Tennessee' ~ '47',
                             state =='Texas' ~ '48',
                             state =='Utah' ~ '49',
                             state =='Vermont' ~ '50',
                             state =='Virginia' ~ '51',
                             state =='Washington' ~ '53',
                             state =='West Virginia' ~ '54',
                             state =='Wisconsin' ~ '55',
                             state =='Wyoming' ~ '56')) 

# st_cd_fips
nums <- c(1, 2, 3, 4, 5, 6, 7, 8, 9)
house_2018_is$cd_fips <- ifelse(house_2018_is$district %in% nums, 
                                paste0("0",house_2018_is$district), 
                                house_2018_is$district)

house_2018_is$st_cd_fips <- paste(house_2018_is$st_fips,
                                  house_2018_is$cd_fips,
                                  sep = "")

# join now
names(house_2012_is)
names(house_2014_is)
names(house_2016_is)
names(house_2018_is)

h_is <- house_2012_is %>%
  rbind(house_2014_is) %>%
  rbind(house_2016_is) %>%
  rbind(house_2018_is)

# check name matching again for ad_tone and party
table(h$party)
h_is <- h_is %>%
  mutate(party = case_when(party == 'Democrat' ~ 'Democrat',
                           party == 'DEMOCRAT' ~ 'Democrat',
                           party == 'Democratic' ~ 'Democrat',
                           party == 'REPUBLICAN' ~ 'Republican',
                           party == 'Republican' ~ 'Republican')) %>%
  mutate(ad_tone = tolower(ad_tone)) %>%
  filter(cycle %in% c(2006, 2010, 2012, 2014, 2016, 2018)) %>%
  rename(ad_purpose = per_ply) %>%
  mutate(ad_purpose = tolower(ad_purpose), 
         ad_purpose = case_when(ad_purpose == 'both personal char. and policy matters' ~ "both",
                                ad_purpose == 'both personal characteristics and policy matters' ~ "both",
                                ad_purpose == 'personal characteristics' ~ "personal",
                                ad_purpose == 'policy matters' ~ "policy"))

# csv
write.csv(h_is, "ads_issues_2012-2018.csv")
```

```{r}

# reading in data written from R script

ads <- read_csv("ads_2006_2018.csv")
ads_issues <- read_csv("ads_issues_2012-2018.csv")

# read data for house party vote share

hpvsd <- read_csv("house party vote share by district 1948-2020.csv")

```

```{r}

# matching the district IDs with the house party vote share data

ads_issues$state_abbr <- state.abb[match(ads_issues$state, state.name)]
ads_issues$district_id <- with(ads_issues, paste0(state_abbr, cd_fips))

# adding the Dem and Rep Vote share percentage to the ads_issues df

ads_issues$DemVotesMajorPercent <- hpvsd$DemVotesMajorPercent[match(ads_issues$district_id, hpvsd$district_id)]
ads_issues$RepVotesMajorPercent <- hpvsd$RepVotesMajorPercent[match(ads_issues$district_id, hpvsd$district_id)]

# filtering for just 2018
# creating an ad count variable for each party and district

ad18 <- ads_issues %>%
  drop_na(RepVotesMajorPercent) %>%
  filter(cycle == 2018) %>%
  group_by(party, st_cd_fips) %>%
  mutate(adcount = n())

```

```{r, eval=FALSE}

# shortening the data by grabbing distinct districts and parties - all other values are the same
# changing the st_cd_fips variable to numeric for the for loop later
# created a new column for the difference in ads between democrats and republicans for each district

ad18_a <- ad18 %>%
  drop_na(party) %>%
  select(party, st_cd_fips, DemVotesMajorPercent, RepVotesMajorPercent, adcount) %>%
  group_by(st_cd_fips) %>%
  distinct(st_cd_fips, party, .keep_all = TRUE) %>%
  mutate(st_cd_fips = as.numeric(st_cd_fips),
         addiff = NA)

# a for loop that fills in the ad difference column with NA if there is not data on one party's advertisements in a district or with the difference between democrats and republican ads run for each district

for(i in 1:max(ad18_a$st_cd_fips)){
  x <- ad18_a %>% filter(st_cd_fips == i)
  ad18_a$addiff[ad18_a$st_cd_fips == i] <- ifelse(nrow(x) > 1, x$adcount[x$party == "Democrat"] - x$adcount[x$party == "Republican"], NA)
}

# writing as a csv so that do not need to run for loop again later --> setting this chunk's eval=FALSE so it does not run again.

write_csv(ad18_a, "ad18_a.csv")

```

```{r}

# reading in the df I created above

ad18_a <- read_csv("ad18_a.csv")

# creating a total cost variable for each party's ad spending per district
# keeping only one row per distrcit/party combo

ad18a <- ad18 %>%
  group_by(st_cd_fips) %>%
  mutate(disttotcost = sum(est_cost)) %>%
  group_by(st_cd_fips, party) %>%
  mutate(totcost = sum(est_cost)) %>%
  select(state, party, st_cd_fips, district_id, RepVotesMajorPercent, DemVotesMajorPercent, adcount, totcost, disttotcost) %>%
  distinct(party, st_cd_fips, .keep_all = TRUE) %>%
  mutate(st_cd_fips = as.numeric(st_cd_fips),
         pctcost = (totcost/disttotcost)*100) %>%
  drop_na(party)

# pasting the number of ads difference from the other data frame to this one

ad18a$addiff <- ad18_a$addiff[match(ad18a$st_cd_fips, ad18_a$st_cd_fips)]

```

To start, I will look at various advertising measurements from the 2018 election and their relationship with the vote share, specifically the Democratic vote share. In the graph below, we can look at the relationship between the difference in the number of ads run per district in 2018 (number of democratic ads minus the number of republican ads) versus the major vote percentage for democrats.

```{r}
ad18a %>%
  filter(party == "Democrat") %>%
  drop_na(addiff) %>%
  ggplot(aes(x = addiff, y = DemVotesMajorPercent)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Difference in Number of Ads Run (Dem - Rep)",
       y = "Democrat Major Vote Percent",
       title = "Difference in the Number of Ads Run vs. Democratic Vote Percentage by District in 2018",
       subtitle = "Each point represents a district with sufficient data")

```

As we can see from the line of best fit, there is a slight positive relationship between these two variables. We can interpret this to mean that on average, when the difference between the amount of ads Democrats run over Republicans is greater in a district, Democrats are more likely to also have a higher major party vote percentage. While the line of best fit depicts the relationship in this way, looking at the data points we can see some heteroskedasticity. When the difference in the number of ads run is around 0, the democratic vote percentage has much more variation than when the difference in the number of ads is greater. One explanation for this pattern could be that districts where there is no competition may not have ads run on either side, thus leading to a difference in ads of 0 but vote percentages that fall on both extremes from 0-100. We can also think of the opposite phenomenon happening, in that highly competitive districts have both parties running lots of ads, leading to a difference of 0 but a vote share that falls much closer to 50, as one party edges the other out narrowly. When one party is running a lot more ads than the other, this may be a district that leans one way but is a toss up so the underdog party might try to push ads to gain the needed votes. We can see this pattern in the points that fall on the right with vote percentages right around 50, but an ad difference that is fairly high.

Below we look at a similar graph, but instead of looking at the difference in the number of ads run, we are looking at the percentage of a district's estimated total ad costs that is spent on Democratic ads. The costs are estimated by the Wesleyan Media Project, so we must consider that there may be some noise in these estimations that is unaccounted for.

```{r}

# graph of pctcost and dem vote pct
# filtering for only the democrat observation for each district
# removing observations where one party had 100% of the advertising costs - there sometimes was only one observation for a district (rep or dem) and that resulted in a pct of 100%

ad18a %>%
  filter(party == "Democrat") %>%
  filter(pctcost != 100) %>%
  ggplot(aes(x = pctcost, y = DemVotesMajorPercent)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Percent Democratic Ad Cost out of Total District Ad Costs (estimated costs)",
       y = "Democrat Major Vote Percent",
       title = "Percent Democratic Ad Cost vs. Democratic Vote Percentage by District in 2018",
       subtitle = "Estimated cost spent on ads by Democrats over the total spending on ads in each district")
```

This graph shows us that there is a positive relationship between the percent of a district's total ad cost that was spent by Democrats and the Democrat major vote percent. Here, the total ad cost for a district -- that is used to calculate the percent value we see on the x-axis -- is defined as the sum of estimated costs for Republican ads in a district plus the sum of estimated costs for Democratic ads in the same district. The positive relationship we see means that on average, when democrats spend a greater percentage of the district's total ad costs, they have a higher major vote percent. In this graph we can also see that districts where democrats made up a higher percent of the district's total ad costs were more competitive, shown by the points on the right falling close to the 50% major vote. We also can see that in districts where the percent of ad costs was split pretty evenly between democrats and republicans, there are vote shares that also fall around 50%. In these competitive districts, we can imagine that campaigning and the running of advertisements is rather important.

```{r}

# mapping plots above




```

### GRPs
According to [Huber and Arceneaux (2007)](https://hollis.harvard.edu/primo-explore/fulldisplay?docid=TN_cdi_proquest_miscellaneous_59786011&context=PC&vid=HVD2&search_scope=everything&tab=everything&lang=en_US), GRPs or Gross Point Ratings are a measure of "the percentage of households viewing the show on which an advertisement was shown". In their research, they measure advertising as the cumulative GRPs of ads in the four weeks leading up to a respondent's interview and use the unit of GRPs/1000. In [Gerber et al. (2011)](https://hollis.harvard.edu/primo-explore/fulldisplay?docid=TN_cdi_proquest_miscellaneous_881466543&context=PC&vid=HVD2&search_scope=everything&tab=everything&lang=en_US), the authors randomly assign the quantity of GRPs to be purchased, with either 250, 500, or 1000 GRPs. The lower GRP meant that the ad would play on a morning show or news show, and the higher GRP meant that the ad would play during a more quality entertainment such as late night entertainment or more prime-time news. GRP is very important in elections because the ad spending budget is so large, however is only impactful if people are seeing the ads -- and even more importantly, if the *right* people are seeing the ads. In order to approximate advertising effects at either the national-level or district level, in addition to knowing how many households the ad aired to, it would also be helpful to know the demographic information of the viewers. For example, there may be a morning news show that engages a lot of working professionals, or a cable show that is watched by lots of older people. Knowing the demographic information of the channels on which the ads are played, in addition with the GRPs, would be very helpful in assessing the advertising effect on elections. This look into demographics may also be able to capture a difference between regular television users and streaming service users. Streaming services are very mainstream these days with people "cutting the cord" for ad-free television experiences. While this innately attracts households with more disposable income, we could possibly obtain even more specific demographic information on these viewers and use it to better measure the effect of advertising on people, as well as make more accurate predictions. With the prevalence of social media these days, I believe it would be fairly easy to target specific demographics with advertising. For example, we have seen Joe Biden use young influencers and pop culture celebrities on TikTok to reach a certain demographic. Using various social media platforms makes it easy to target specific people and compare voting results to a time before these targeted ads were used.







```{r}

# reading in data used to make old model
poll <- read_csv("week3_data.csv")


```

```{r, results = 'asis', message=FALSE, warning = FALSE}

# old model

poll2 <- poll

fit7 <- lm(D_majorvote_pct ~ support + President_party + H_incumbent + unrate + unrate*President_party, data = poll2, weights = days_until_election)

# stargazer(fit7, type = "html", covariate.labels = c("Generic Ballot Support", "President Party - Republican", "House Incumbent - Republican", "Unemployment Rate", "President Party - R * Unemployment Rate", "Constant"))

```















